<!DOCTYPE html>
<html class=" js-no-overflow-scrolling">
<head>
<meta charset="utf-8">
<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>test1</title>
<style type="text/css">
	
	html, body {
		margin: 0;
		width: 100%;
		height: 100%;
	}
	
	* {
		margin:0;
		padding: 0;
	}
	ul {
		list-style: none;
	}
	.item {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		overflow: hidden;
		/*transition: all 800ms cubic-bezier(0.550, 0.085, 0.000, 0.990);
		-webkit-transition: all 800ms cubic-bezier(0.550, 0.085, 0.000, 0.990);*/
        transition: all 300ms ease-in-out;
        -webkit-transition: all 300ms ease-in-out;
		background-position: center;
	}
	.item2 {
		background-image: url(img2.png);
	}
	.item1 {
		background-image: url(img.png);
	}
	.item3 {
		background-image: url(img3.png);
	}
	.item4 {
		background-image: url(img.png);
	}
	.item5 {
		background-image: url(img2.png);
	}
    .item:not(:first-child ) {
        transform: translate3d(0,100%,0);
        -webkit-transform: translate3d(0,100%,0);
    }
	.container {
		width: 100%;
		height: 100%;
		overflow: hidden;
		position: relative;
		
	}
	.no-animation {
		transition: none;
		-webkit-transition: none;
	}
	.overlay {
		display: none;
		position: absolute;
		top: 0;
		left: 0;
		bottom: 0;
		right: 0;
		z-index: 99;
	}
    .zindex {
        z-index: 99;
    }
</style>

</head>
<body>
	<div class="container">
		<div class="item item1"></div>
		<div class="item item2">
            <h1>213333</h1>
        </div>
		<div class="item item3"></div>
		<div class="item item4"></div>
		<div class="item item5"></div>
	</div>
	<script type="text/javascript" src="zepto.js"></script>
	<script type="text/javascript">
    (function(){
         var opt = {
            'type' : 1,
            'pageShow' : function(){},
            'pageHide' : function(){}
         };
         window.MagicPage = {
            'init' : function(option){
                $.extend(opt,option);
                $('body').append('<div class="overlay"></div>');
                // 绑定事件
                $(document).on('touchmove', function(e){
                    e.preventDefault();
                });
                if (opt.type > 4) {
                    opt.type = opt.type - 4;
                    $('.item').on({
                        'swipeUp': swipeUp,
                        'swipeDown': swipeDown
                    });
                } else {
                    $('.item').on({
                       'touchstart': touchStart,
                       'touchmove': touchMove,
                       'touchend': touchEnd
                    });
                }
                
                $('.item').on('tap', function(){
                    //覆盖层隐藏
                    $('.overlay').hide();
                });
                $('.item').on('transitionend', function(event){
                   //覆盖层隐藏
                   $('.overlay').hide();
                   console.log($(event.target).attr('state'));
                   if ($(event.target).attr('state') == 'next') {
                        opt.pageShow(event.target);
                   } else {
                        opt.pageHide(event.target);
                   }
                   // opt.pageComplete(event.target);
                   // debugger;
                });
                $('.overlay').on('tap', function(){
                    //覆盖层隐藏
                    $('.overlay').hide();
                });
            }
         };
         
         var obj = {
             '1' : {
                 'upDrag' : function(percentage, event){
                     var translateY = 1 - 0.7*percentage;//位置系数，可以微调
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,'+translateY*100+'%,0)'); //下一个item上移动
                 },
                 'downDrag' : function(percentage, event){
                     var translateY = -(0.7*percentage);
                     $(event.target).prev().css('-webkit-transform', 'translate3d(0,'+(translateY*100 - 100)+'%,0)');
                     $(event.target).css('-webkit-tr ansform', 'translate3d(0,'+translateY*100+'%,0)');//当前item下移动
                 },
                 'nextSlide' : function(event){
                     $(event.target).css('-webkit-transform', 'translate3d(0,-100%,0)'); 
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,0,0)');
                 },
                 'prevSlide' : function(event){
                     $(event.target).prev().css('-webkit-transform', 'scale(1)'); 
                     $(event.target).css('-webkit-transform', 'translate3d(0,100%,0)'); 
                 },
                 'showSlide' : function(event){
                     $(event.target).css('-webkit-transform', 'scale(1)'); 
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,100%,0)'); 
                 }
             },
             '2' : {
                 'upDrag' : function(percentage, event){
                     var scale = 1 - 0.2*percentage;//缩放系数，可以微调
                     var translateY = 1 - 0.7*percentage;//位置系数，可以微调
                     $(event.target).css('-webkit-transform', 'scale('+scale+')');//当前item缩小
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,'+translateY*100+'%,0)'); //下一个item上移动
                 },
                 'downDrag' : function(percentage, event){
                     var scale = 0.8 - 0.2*percentage;
                     var translateY = -(0.7*percentage);
                     $(event.target).css('-webkit-transform', 'translate3d(0,'+translateY*100+'%,0)');//当前item下移动
                     $(event.target).prev().css('-webkit-transform', 'scale('+scale+')');//前一个item放大
                 },
                 'nextSlide' : function(event){
                     $(event.target).css('-webkit-transform', 'scale(.8)'); 
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,0,0)');
                 },
                 'prevSlide' : function(event){
                     $(event.target).prev().css('-webkit-transform', 'scale(1)'); 
                     $(event.target).css('-webkit-transform', 'translate3d(0,100%,0)'); 
                 },
                 'showSlide' : function(event){
                     $(event.target).css('-webkit-transform', 'scale(1)'); 
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,100%,0)'); 
                 }
             },
             '3' : {
                 'upDrag' : function(percentage, event){
                     var translateY = 1 - 0.4*percentage;//位置系数，可以微调
                     $(event.target).css('-webkit-transform', 'translate3d(0,'+(translateY*100 - 100)+'%,0)');
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,'+translateY*100+'%,0)'); //下一个item上移动
                 },
                 'downDrag' : function(percentage, event){
                     var translateY = -(0.4*percentage);
                     $(event.target).prev().css('-webkit-transform', 'translate3d(0,'+(translateY*100 - 100)+'%,0)');
                     $(event.target).css('-webkit-transform', 'translate3d(0,'+translateY*100+'%,0)');//当前item下移动
                 },
                 'nextSlide' : function(event){
                     $(event.target).css('-webkit-transform', 'translate3d(0,-100%,0)'); 
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,0,0)');
                 },
                 'prevSlide' : function(event){
                     $(event.target).prev().css('-webkit-transform', 'scale(1)'); 
                     $(event.target).css('-webkit-transform', 'translate3d(0,100%,0)'); 
                 },
                 'showSlide' : function(event){
                     $(event.target).css('-webkit-transform', 'scale(1)'); 
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,100%,0)'); 
                 }
             },
             '4' : {
                 'upDrag' : function(percentage, event){
                     var translateY = 1 - 0.4*percentage;//位置系数，可以微调
                     $(event.target).css('-webkit-transform', 'translate3d(0,'+(translateY*100 - 100)+'%,0)');
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,'+translateY*100+'%,0)'); //下一个item上移动
                 },
                 'downDrag' : function(percentage, event){
                     var translateY = -(0.4*percentage);
                     $(event.target).prev().css('-webkit-transform', 'translate3d(0,'+(translateY*100 - 100)+'%,0)');
                     $(event.target).css('-webkit-transform', 'translate3d(0,'+translateY*100+'%,0)');//当前item下移动
                 },
                 'nextSlide' : function(event){
                     $(event.target).addClass('zindex');
                     setTimeout(function(){
                         $(event.target).removeClass('no-animation').css('-webkit-transform', 'translate3d(0,-100%,0)');
                         $(event.target).next().removeClass('zindex').addClass('no-animation').css('-webkit-transform', 'translate3d(0,0,0)');
                     },100);
                     
                 },
                 'prevSlide' : function(event){
                     
                     $(event.target).prev().css('-webkit-transform', 'translate3d(0,0,0)'); 
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,100%,0)'); 
                     $(event.target).removeClass('zindex');
                 },
                 'showSlide' : function(event){
                     $(event.target).css('-webkit-transform', 'scale(1)'); 
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,100%,0)'); 
                 }
             }
         };
         var dragThreshold = 0.25; //临界值
         var dragStart = null;//开始抓取标志位
         var percentage = 0;//拖动量的百分比
          
         function touchStart(event) {
            if (dragStart !== null) return;
             if (!$(event.target).hasClass('item')) {
                 $('.overlay').hide();
                 return;
             }
            if (event.touches) {
                event = event.touches[0];
            }
             //抓取时的所在位置
            dragStart = event.clientY;
          
             //分别关闭item的动画效果,动画效果只在松开抓取时出现
            $(event.target).addClass('no-animation');
            $(event.target).next().addClass('no-animation');
            $(event.target).prev().addClass('no-animation');

         }
          
         function touchMove (event) {
             //console.log(33);
            //防止ios拖动事件
            event.preventDefault();
            
            if (dragStart === null) return;
             if (!$(event.target).hasClass('item')) {
                 $('.overlay').hide();
                 return;
             }
            if (event.touches) {
                event = event.touches[0];
            }
             //得到抓取开始时于进行中的差值的百分比
            percentage = (dragStart - event.clientY) / window.screen.height;//
             
            if (percentage > 0) {
                // //向上拖动
                var scale = 1 - 0.5*percentage;//缩放系数，可以微调
                // var translateY = 1 - 0.4*percentage;//位置系数，可以微调
                // $(event.target).css('-webkit-transform', 'scale('+scale+')');//当前item缩小
                // $(event.target).next().css('-webkit-transform', 'translateY('+translateY*100+'%)'); //下一个item上移动
                 //$(event.target).css('opacity', ''+scale+'');//当前item缩小
                 obj[opt.type].upDrag(percentage, event);
                 //console.log(1);
            } else if ($(event.target).prev()) {
                //向下拖动
                // var scale = 0.8 - 0.2*percentage;
                // var translateY = -(0.4*percentage);
                // $(event.target).css('-webkit-transform', 'translateY('+translateY*100+'%)');//当前item下移动
                // $(event.target).prev().css('-webkit-transform', 'scale('+scale+')');//前一个item放大
                 obj[opt.type].downDrag(percentage, event);
            }
            
         }
          
         function touchEnd (event) {
            //防止多次滚动，故增加一个覆盖层
            $('.overlay').show();
            dragStart = null;
             if (!$(event.target).hasClass('item')) {
                 $('.overlay').hide();
                 return;
             }
            $(event.target).removeClass('no-animation');
            $(event.target).next().removeClass('no-animation');
            $(event.target).prev().removeClass('no-animation');
            
            //抓取停止后，根据临界值做相应判断
            if (percentage >= dragThreshold) {
                nextSlide(event);
            } else if ( Math.abs(percentage) >= dragThreshold ) {
                prevSlide(event);
            } else {
                showSlide(event);
            }
             //重置percentage
            percentage = 0;

         }
         function swipeUp(event){
             nextSlide(event);
             //$(event.target).css('-webkit-transform', 'translateY(-101%)'); 
             //$(event.target).next().css('-webkit-transform', 'translateY(0)'); 
         }
         function swipeDown(event){
             prevSlide(event);
             //$(event.target).css('-webkit-transform', 'translateY(101%)'); 
             //$(event.target).prev().css('-webkit-transform', 'translateY(0)'); 
         }
         function nextSlide(event){
            //恢复到原样，或者展示下一item
            if ($(event.target).next().length) {
                $(event.target).attr('state','prev');
                $(event.target).next().attr('state','next');
                 obj[opt.type].nextSlide(event);
            } else {
                 obj[opt.type].showSlide(event);
            }
            
         }
         function prevSlide(event){
            if ($(event.target).prev().length) {
                $(event.target).attr('state','prev');
                 $(event.target).prev().attr('state','next');
                 obj[opt.type].prevSlide(event);
            } else {
                obj[opt.type].showSlide(event);
            }
            
         }
         function showSlide(event){
             obj[opt.type].showSlide(event);
         }
         
    })();
    MagicPage.init({'type':2,'pageShow' : function(dom){
        console.log(dom);
    },'pageHide' : function(dom){
        console.log(11);
        console.log(dom);
    }});
    
	</script>
</body>
</html>