<!DOCTYPE html>
<html class=" js-no-overflow-scrolling">
<head>
<meta charset="utf-8">
<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>test1</title>
<style type="text/css">
    
    html, body {
        margin: 0;
        width: 100%;
        height: 100%;
    }
    
    * {
        margin:0;
        padding: 0;
    }
    ul {
        list-style: none;
    }
    .item {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        transition: all 700ms cubic-bezier(0.550, 0.085, 0.000, 0.990);
        -webkit-transition: all 700ms cubic-bezier(0.550, 0.085, 0.000, 0.990);
        /*transition: all 300ms ease-in-out;
        -webkit-transition: all 300ms ease-in-out;*/
        background-position: center;
    }
    .item2 {
        background-color: #0067A6;
    }
    .item1 {
        background-color: #00ABD8;
    }
    .item3 {
        background-color: #008972;
    }
    .item4 {
        background-color: #F5C564;
    }
    .item5 {
        background-color: #F2572D;
    }
    .item:not(:first-child ) {
        transform: translate3d(0,100%,0);
        -webkit-transform: translate3d(0,100%,0);
    }
    .container {
        width: 100%;
        height: 100%;
        overflow: hidden;
        position: relative;
        
    }
    .no-animation {
        transition: none;
        -webkit-transition: none;
    }
    .overlay {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        z-index: 99;
    }
    .zindex {
        z-index: 99;
    }
    .arrow {
        width: 25px;
        height: 25px;
        position: absolute;
        bottom: 18px;
        left: 50%;
        margin-left: -10px;
        border-top: 2px solid #5a584e;
        border-left: 2px solid #5a584e;
        z-index: 9999;
        display: block;
        -webkit-tap-highlight-color: rgba(255,255,255,0);
        animation: fadeInUp 1.5s .2s ease infinite;
        -webkit-animation: fadeInUp 1.5s .2s infinite;
    }
    .music {
        position: absolute;
        right: 10px;
        top: 10px;
        width: 25px;
        height: 25px;
        background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADcAAAA3CAMAAACfBSJ0AAAAh1BMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9qkf8RAAAALHRSTlMA6j0E4S2vQO/nFWs2Dgga+VMo7M25h3ZG02Vbmnww87NNP96oI8CMb5Lg1UAzAj8AAAKLSURBVEjHndbbkqMgEADQRpSAGsX7XeMmMcmO//99WzqzEgWMNf2QB6tOEZqGblCFHaSkQHzkqLikgQ2Hws9iemmC1saA7TZoLjTO/I/KJVF9wqtP+FRHxN1VYXItPcV3r7wmoVZ5KXMwqAM7LPU0ixVkLwU2KZRL5siB/XBQLn+smAGfwkCVxEwLPjvKNjA3wwMMnaz1X70j9xCbfu5vBxCXBxmAE4vjSMke8PI0Nmc2B0mXg2Pac8NGM3Dz5owLA5v9T0XiqI2bJR26lSHAeVwYgJP8lLKJZWQ9L5SSp/WT7lEwwOZ3Eom0XHBDXZK5eElJNK7qZk6HT6V6/fsyJiNYs3Iene5jVsM2TOs9MzXnbOWgzgAgPqmcyAzlj/C8dqcYwI+wwonMVFMmNw4jGwICsgvKn8zMxy05IAGkjcLxoTGwKC7JNQ8gvcK1q5qUXX+BwlI4SzClswpAtsYJJjufAccaJ5jszh2MoHGCyQ5GzXqCadbT7U8w3OZ5L+1Pk0/Byoher1cpn+rzqxZWoVx5fsp6YfS0XKleXS+q+jTGcnkgKYCyPrf3oa9vA+fLnkP0nYdOug8QGyDixh51V9PFYerOyRnWfyie7vtLfHCKs4H+vN/37OsO4Eb5yr0ymC6ueF+KfmLvDr+6Ie7KFfMif/Oe8X5iws2pKatNaThk+35GdGIeV9SQ/H6K99rgybynYb/tJpv+YKDArFsrpa3WiP4g+tGUEv9GebLLgKSr/jezDyH6n+i3B5mL7qv+zughZqF8O4ZYB1hoVr+ZX1xW/WpeinLNfObvKF8znwF4j+ipnQef0cMDXbQ782f7Yd6linmXEvfwfO2fAfTztX6eZ3Sk7Es3z/8D0fgrl5NXHdYAAAAASUVORK5CYII=');

        background-size: 25px;
        z-index: 99;
    }
    .music.play {
        background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADcAAAA3CAMAAACfBSJ0AAAAilBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////2N2iNAAAALXRSTlMA6y3h5gVsDgg2snYaPe/UFqtTKPK4r4Z9ZUxFMAP3WpokE97NiyzOv2mjksf96K+aAAACWUlEQVRIx52W6a6CMBCFp9pi2cq+L4LiLu//ejdgIkJL4XJ+GGnypfQM0zkg0smNHAu1bYss7eKeYJUMvfG12M1tAsTO3VjzG91YpNQQVSYZLRGzQqEqpbzgnFDgRZNz4M1SNMIPAmKRB47ozGZWaMO87NASbpkhBeRSUMYvHrEJSzLxkceusKzrFMywB2u0G79qjVRYJxPVPwVoElgrpRnKETkgEc2iNx4ew+hbODxbN2LG9xI/lfanjl8rAnHhClUPfOQ8aoDDDwdKAL3UPREYp2iMacqu+z/hyP5jYsht5zrID3S1AAABB0rY9xujU27/GrcSTUccZV0/6hVw3G7qzIiDSgeAxhRzgzNJfRhzZgNgo0LM9c6EH2cmXIFO4GrAc+5jcEbAgeZCFAu48h4Pzgi4+AJOKuDy7lfCpRpYOwG3W+CuFiB7A2dgKMkG7uBDCxs4aLfut3w+kmdZyp1v0c8EsfP5zPvppFLuiDJx/aJYyu3Tme/FDWVczYqZ79MY90NaOY5TfjkPfXzwuX6A22//PfFF13X25QhTe3Pu4/67df3+GhYU6zQ5n24ZAOpkEL307h3QcL9Y6dSX4lXe334ywigy+vvs8V0pT3zd6+RoT656bXp/4h6gpfj+Hu7P6X1dPfszveWTJeDmg72v8mvk5zLMxh4/j4wnKwMxxs8joLd/zL8b3TJvVVRvnO9b8oSHj1vyi8pjAOmKvJTO5DNDQhmONeMBvSBlNg8q6EJhTrkkf+byo2tMkHeZpq7J16zL18YBij5fs5skX/N5Hvutj2fz/B/LOymzX/xZaQAAAABJRU5ErkJggg==');
        -webkit-animation: rotate 3.82s linear infinite;
        animation: rotate 3.82s linear infinite;
    }
    @keyframes fadeInUp{0%{opacity:0;transform:translateY(-20px) rotate(-135deg)}100%{opacity:1;transform:translateY(0px) rotate(-135deg)}}@-webkit-keyframes fadeInUp{0%{opacity:0;-webkit-transform:translateY(-20px) rotate(-135deg)}100%{opacity:1;-webkit-transform:translateY(0px) rotate(-135deg)}}
    @keyframes rotate{0%{-webkit-transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg)}}@-webkit-keyframes rotate{0%{-webkit-transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg)}}
    .fadeIn {
        animation-name: fadeIn;
        -webkit-animation-name: fadeIn; 

        animation-duration: 1.5s;   
        -webkit-animation-duration: 1.5s;

        animation-timing-function: ease-in-out; 
        -webkit-animation-timing-function: ease-in-out;     

        visibility: visible !important;
    }

    @keyframes fadeIn {
        0% {
            transform: scale(0);
            opacity: 0.0;       
        }
        60% {
            transform: scale(1.1);  
        }
        80% {
            transform: scale(0.9);
            opacity: 1; 
        }   
        100% {
            transform: scale(1);
            opacity: 1; 
        }       
    }

    @-webkit-keyframes fadeIn {
        0% {
            -webkit-transform: scale(0);
            opacity: 0.0;       
        }
        60% {
            -webkit-transform: scale(1.1);
        }
        80% {
            -webkit-transform: scale(0.9);
            opacity: 1; 
        }   
        100% {
            -webkit-transform: scale(1);
            opacity: 1; 
        }       
    }
    .slideLeft{
        animation-name: slideLeft;
        -webkit-animation-name: slideLeft;  

        animation-duration: 1s; 
        -webkit-animation-duration: 1s;

        animation-timing-function: ease-in; 
        -webkit-animation-timing-function: ease-in;     

        visibility: visible !important; 
    }

    @keyframes slideLeft {
        0% {
            -webkit-transform: translateX(100%);
        }
        50%{
            -webkit-transform: translateX(50%);
        }
        65%{
            -webkit-transform: translateX(20%);
        }
        
        95%{
            -webkit-transform: translateX(10%);
        }           
        100% {
            -webkit-transform: translateX(0%);
        }
    }

    @-webkit-keyframes slideLeft {
        0% {
            -webkit-transform: translateX(100%);
        }
        100% {
            -webkit-transform: translateX(0%);
        }
    }
    .aa {
        display: none;
        position: absolute;
        bottom: 60px;
        text-align: center;
        width: 100%;
    }
</style>

</head>
<body>
    <div class="container">
        <div class="item item1">
            <h1>page1</h1>
            <div class="aaa fadeIn">aaaaaaaaa</div>
        </div>
        <div class="item item2">
            <h1>page2</h1>
            <div class="aa slideLeft">aaaaaaaaa</div>
        </div>
        <div class="item item3">
            <h1>page3</h1>
        </div>
        <div class="item item4">
            <h1>page4</h1>
        </div>
        <div class="item item5">
            <h1>page5</h1>
        </div>
    </div>
    <script type="text/javascript" src="zepto.js"></script>
    <script type="text/javascript">
    (function(){
         var opt = {
            'type' : 1,
            'pageShow' : function(){},
            'pageHide' : function(){},
            'useArrow' : true,
            'useMusic' : {
                'autoPlay' : true,
                'loopPlay' : true,
                'src' : 'http://mat1.gtimg.com/news/2015/love/FadeAway.mp3'
            }
         };
         window.MagicPage = {
            'init' : function(option){
                $.extend(opt,option);
                initDom(opt);
                initEvent(opt);
            }
         };
         
         var obj = {
             '1' : {
                 'upDrag' : function(percentage, event){
                     var translateY = 1 - 0.7*percentage;//位置系数，可以微调
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,'+translateY*100+'%,0)'); //下一个item上移动
                 },
                 'downDrag' : function(percentage, event){
                     var translateY = -(0.7*percentage);
                     $(event.target).prev().css('-webkit-transform', 'translate3d(0,'+(translateY*100 - 100)+'%,0)');
                     $(event.target).css('-webkit-tr ansform', 'translate3d(0,'+translateY*100+'%,0)');//当前item下移动
                 },
                 'nextSlide' : function(event){
                     $(event.target).css('-webkit-transform', 'translate3d(0,-100%,0)'); 
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,0,0)');
                 },
                 'prevSlide' : function(event){
                     $(event.target).prev().css('-webkit-transform', 'scale(1)'); 
                     $(event.target).css('-webkit-transform', 'translate3d(0,100%,0)'); 
                 },
                 'showSlide' : function(event){
                     $(event.target).css('-webkit-transform', 'scale(1)'); 
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,100%,0)'); 
                 }
             },
             '2' : {
                 'upDrag' : function(percentage, event){
                     var scale = 1 - 0.2*percentage;//缩放系数，可以微调
                     var translateY = 1 - 0.7*percentage;//位置系数，可以微调
                     $(event.target).css('-webkit-transform', 'scale('+scale+')');//当前item缩小
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,'+translateY*100+'%,0)'); //下一个item上移动
                 },
                 'downDrag' : function(percentage, event){
                     var scale = 0.8 - 0.2*percentage;
                     var translateY = -(0.7*percentage);
                     $(event.target).css('-webkit-transform', 'translate3d(0,'+translateY*100+'%,0)');//当前item下移动
                     $(event.target).prev().css('-webkit-transform', 'scale('+scale+')');//前一个item放大
                 },
                 'nextSlide' : function(event){
                     $(event.target).css('-webkit-transform', 'scale(.8)'); 
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,0,0)');
                 },
                 'prevSlide' : function(event){
                     $(event.target).prev().css('-webkit-transform', 'scale(1)'); 
                     $(event.target).css('-webkit-transform', 'translate3d(0,100%,0)'); 
                 },
                 'showSlide' : function(event){
                     $(event.target).css('-webkit-transform', 'scale(1)'); 
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,100%,0)'); 
                 }
             },
             '3' : {
                 'upDrag' : function(percentage, event){
                     var translateY = 1 - 0.4*percentage;//位置系数，可以微调
                     $(event.target).css('-webkit-transform', 'translate3d(0,'+(translateY*100 - 100)+'%,0)');
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,'+translateY*100+'%,0)'); //下一个item上移动
                 },
                 'downDrag' : function(percentage, event){
                     var translateY = -(0.4*percentage);
                     $(event.target).prev().css('-webkit-transform', 'translate3d(0,'+(translateY*100 - 100)+'%,0)');
                     $(event.target).css('-webkit-transform', 'translate3d(0,'+translateY*100+'%,0)');//当前item下移动
                 },
                 'nextSlide' : function(event){
                     $(event.target).css('-webkit-transform', 'translate3d(0,-100%,0)'); 
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,0,0)');
                 },
                 'prevSlide' : function(event){
                     $(event.target).prev().css('-webkit-transform', 'scale(1)'); 
                     $(event.target).css('-webkit-transform', 'translate3d(0,100%,0)'); 
                 },
                 'showSlide' : function(event){
                     $(event.target).css('-webkit-transform', 'scale(1)'); 
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,100%,0)'); 
                 }
             },
             '4' : {
                 'upDrag' : function(percentage, event){
                     var translateY = 1 - 0.4*percentage;//位置系数，可以微调
                     $(event.target).css('-webkit-transform', 'translate3d(0,'+(translateY*100 - 100)+'%,0)');
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,'+translateY*100+'%,0)'); //下一个item上移动
                 },
                 'downDrag' : function(percentage, event){
                     var translateY = -(0.4*percentage);
                     $(event.target).prev().css('-webkit-transform', 'translate3d(0,'+(translateY*100 - 100)+'%,0)');
                     $(event.target).css('-webkit-transform', 'translate3d(0,'+translateY*100+'%,0)');//当前item下移动
                 },
                 'nextSlide' : function(event){
                     $(event.target).addClass('zindex');
                     setTimeout(function(){
                         $(event.target).removeClass('no-animation').css('-webkit-transform', 'translate3d(0,-100%,0)');
                         $(event.target).next().removeClass('zindex').addClass('no-animation').css('-webkit-transform', 'translate3d(0,0,0)');
                     },100);
                     
                 },
                 'prevSlide' : function(event){
                     
                     $(event.target).prev().css('-webkit-transform', 'translate3d(0,0,0)'); 
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,100%,0)'); 
                     $(event.target).removeClass('zindex');
                 },
                 'showSlide' : function(event){
                     $(event.target).css('-webkit-transform', 'scale(1)'); 
                     $(event.target).next().css('-webkit-transform', 'translate3d(0,100%,0)'); 
                 }
             }
         };
         var dragThreshold = 0.15; //临界值
         var dragStart = null;//开始抓取标志位
         var percentage = 0;//拖动量的百分比
          
         function touchStart(event) {
            if (dragStart !== null) return;
             if (!$(event.target).hasClass('item')) {
                 $('.overlay').hide();
                 return;
             }
            if (event.touches) {
                event = event.touches[0];
            }
             //抓取时的所在位置
            dragStart = event.clientY;
          
             //分别关闭item的动画效果,动画效果只在松开抓取时出现
            $(event.target).addClass('no-animation');
            $(event.target).next().addClass('no-animation');
            $(event.target).prev().addClass('no-animation');

         }
          
         function touchMove (event) {
             //console.log(33);
            //防止ios拖动事件
            event.preventDefault();
            
            if (dragStart === null) return;
             if (!$(event.target).hasClass('item')) {
                 $('.overlay').hide();
                 return;
             }
            if (event.touches) {
                event = event.touches[0];
            }
             //得到抓取开始时于进行中的差值的百分比
            percentage = (dragStart - event.clientY) / window.screen.height;//
             
            if (percentage > 0) {
                // //向上拖动
                var scale = 1 - 0.5*percentage;//缩放系数，可以微调
                // var translateY = 1 - 0.4*percentage;//位置系数，可以微调
                // $(event.target).css('-webkit-transform', 'scale('+scale+')');//当前item缩小
                // $(event.target).next().css('-webkit-transform', 'translateY('+translateY*100+'%)'); //下一个item上移动
                 //$(event.target).css('opacity', ''+scale+'');//当前item缩小
                 obj[opt.type].upDrag(percentage, event);
                 //console.log(1);
            } else if ($(event.target).prev()) {
                //向下拖动
                // var scale = 0.8 - 0.2*percentage;
                // var translateY = -(0.4*percentage);
                // $(event.target).css('-webkit-transform', 'translateY('+translateY*100+'%)');//当前item下移动
                // $(event.target).prev().css('-webkit-transform', 'scale('+scale+')');//前一个item放大
                 obj[opt.type].downDrag(percentage, event);
            }
            
         }
          
         function touchEnd (event) {
            //防止多次滚动，故增加一个覆盖层
            $('.overlay').show();
            dragStart = null;
             if (!$(event.target).hasClass('item')) {
                 $('.overlay').hide();
                 return;
             }
            $(event.target).removeClass('no-animation');
            $(event.target).next().removeClass('no-animation');
            $(event.target).prev().removeClass('no-animation');
            
            //抓取停止后，根据临界值做相应判断
            if (percentage >= dragThreshold) {
                nextSlide(event);
            } else if ( Math.abs(percentage) >= dragThreshold ) {
                prevSlide(event);
            } else {
                showSlide(event);
            }
             //重置percentage
            percentage = 0;

         }
         function swipeUp(event){
             nextSlide(event);
             //$(event.target).css('-webkit-transform', 'translateY(-101%)'); 
             //$(event.target).next().css('-webkit-transform', 'translateY(0)'); 
         }
         function swipeDown(event){
             prevSlide(event);
             //$(event.target).css('-webkit-transform', 'translateY(101%)'); 
             //$(event.target).prev().css('-webkit-transform', 'translateY(0)'); 
         }
         function nextSlide(event){
            //恢复到原样，或者展示下一item
            if ($(event.target).next().length) {
                $(event.target).attr('state','prev');
                $(event.target).next().attr('state','next');
                 obj[opt.type].nextSlide(event);
            } else {
                 obj[opt.type].showSlide(event);
            }
            
         }
         function prevSlide(event){
            if ($(event.target).prev().length) {
                $(event.target).attr('state','prev');
                $(event.target).prev().attr('state','next');
                obj[opt.type].prevSlide(event);
            } else {
                obj[opt.type].showSlide(event);
            }
            
         }
         function showSlide(event){
             obj[opt.type].showSlide(event);
         }
         function initDom(opt){
            $('body').append('<div class="overlay"></div>');
            if (opt.useArrow) {
                $('.item').append('<span class="arrow"></span>');
            }
            if (opt.useMusic) {
                var autoplay = opt.useMusic.autoPlay ? 'autoplay="autoplay"' : '';
                var loopPlay = opt.useMusic.loopPlay ? 'loop="loop"' : '';
                var src = opt.useMusic.src;
                $('body').append('<span class="music play"><audio id="audio" src='+src+' '+autoplay+' '+loopPlay+'></audio></span>');
            }
         }
         function initEvent(){
            $('.music').on('tap',function(){
                $(this).toggleClass('play');
                var audio = document.getElementById('audio');
                if (audio.paused) {
                    audio.play();
                } else {
                    audio.pause();
                }
            });
            // 绑定事件
            $(document).on('touchmove', function(e){
                e.preventDefault();
            });
            if (opt.type > 4) {
                opt.type = opt.type - 4;
                $('.item').on({
                    'swipeUp': swipeUp,
                    'swipeDown': swipeDown
                });
            } else {
                $('.item').on({
                   'touchstart': touchStart,
                   'touchmove': touchMove,
                   'touchend': touchEnd,
                   'touchcancel': touchEnd
                });
            }
            
            $('.item').on('tap', function(){
                //覆盖层隐藏
                $('.overlay').hide();
            });
            $('.item').on('transitionend', function(event){
               //覆盖层隐藏
               $('.overlay').hide();
               //console.log($(event.target).attr('state'));
               if ($(event.target).attr('state') == 'next') {
                    opt.pageShow(event.target);
               } else {
                    opt.pageHide(event.target);
               }
               // opt.pageComplete(event.target);
               // debugger;
            });
            $('.overlay').on('tap', function(){
                //覆盖层隐藏
                $('.overlay').hide();
            });
         }
         
    })();
    MagicPage.init({'type':2,'pageShow' : function(dom){
        //console.log(dom);
        //$(dom).find('.aa').hide().removeClass('fadeIn');
        $(dom).find('.aa').show();
        setTimeout(function(){
            //$(dom).find('.aa').addClass('fadeIn');
        });
    },'pageHide' : function(dom){
        //console.log(dom);
    }});
    
    </script>
</body>
</html>